buildDocker:
  stage: build
  tags:
    - jyaa
  only:
    - main
  script:
    - echo "Construimos la imagen de Docker"
    - docker buildx build . -t grupo5-docker

detenemosContainer:
  stage: test
  tags:
    - jyaa
  needs:
    - buildDocker
  only:
    - main
  script:
    - echo "Detenemos cualqueir tipo de contenedor existente previo"
    - docker stop grupo5 || true

eliminamosContainer:
  stage: test
  tags:
    - jyaa
  only:
    - main
  needs:
    - detenemosContainer
  script:
    - echo "Eliminamos cualqueir tipo de contenedor existente previo"
    - docker rm grupo5 || true

deploy1:
  stage: deploy
  tags:
    - jyaa
  needs:
    - eliminamosContainer
  only:
    - main
  script:
    - echo "Deploy del nuevo contenedor con los cambios"
    - docker run -e APP_ENV=production --network javaproyec_jyaa-network -p 8085:8080 -l "traefik.enable=true" -l "traefik.http.routers.grupo5.rule=Host(\`grupo5.jyaa-ci.linti.unlp.edu.ar\`)" -l "traefik.http.routers.grupo5.entrypoints=websecure" -l "traefik.http.routers.grupo5.tls.certresolver=le" -l "traefik.http.services.grupo5.loadbalancer.server.port=8080" -d --name grupo5 grupo5-docker
